<%- include ../includes/header %>
<%- include ../includes/headercsslinks %>
<link rel="stylesheet" href="css/login.css"/>
<style>
    .street-view-size {
        min-width: 28em;
        min-height: 28em;
    }

    .gmnoprint img {
        max-width: none;
    }

    .visibility-hidden {
        visibility: hidden;
    }
</style>
<%- include ../includes/closingheader %>
<%- include ../includes/navheader %>
<div class="row mt-2">
    <div class="col-md-12 mt-2">
        <ul class="nav nav-tabs mt-2" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="images-tab" data-toggle="tab" href="#home" role="tab"
                   aria-controls="home"
                   aria-selected="true">Images</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
                   aria-controls="profile" aria-selected="false">Area map</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="streetview-tab" data-toggle="tab" href="#streetview-image" role="tab"
                   aria-controls="streetview-image" aria-selected="false">Street view</a>
            </li>
        </ul>
    </div>

</div>
<div class="row h-100 mb-2 mt-2" style="margin-top:0.1em;">
    <div class="col-md-5">
        <div class="tab-content " id="myTabContent" style="max-width: 100%;">
            <div class="tab-pane fade show active " id="home" role="tabpanel" aria-labelledby="images-tab">
                <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        <% for(var i = 0;i < property.ImageUrl.length;i++){ %>
                        <div class="carousel-item <%= i == 0 ? "active" : "" %>">
                            <img class="d-block w-100" src="<%= property.ImageUrl[i] %>" alt="First slide"
                                 style="height:20em;">
                        </div>
                        <% } %>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
                <div class="row mt-2">
                    <% for(var i = 0;i < property.ImageUrl.length;i++){ %>
                    <div class="col-3">
                        <img data-target="#carouselExampleControls" data-slide-to="<%= i %>"
                             class="card-img-top small-uploaded-img" src="<%= property.ImageUrl[i] %>">
                    </div>
                    <% } %>
                </div>
            </div>
            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                <div id="mymap" class="col-md-12" style="min-width: 25em;min-height: 25em;"></div>
            </div>
            <div class="tab-pane show active " id="streetview-image" role="tabpanel" aria-labelledby="streetview-tab">
                <div id="streetview" class="col-md-12 street-view-size visibility-hidden">
                </div>
            </div>
        </div>


    </div>
    <div class="col-md-3">
        <div class="clearfix rounded-0 ">
            <div class="list-group rounded-0">
                <button type="button" class="list-group-item rounded-0 bg-success justify-content-center">
                    KSH: <%= property.Price %><%= property.SaleOrNot == "rent" ? "  per " + property.PaymentMode : "" %>
                </button>
                <button type="button"
                        class="list-group-item rounded-0 justify-content-center"><%= property.Address.length>0 ?property.Address:"Not Stated" %>
                </button>
                <button type="button" class="list-group-item rounded-0 list-group-item-action d-flex flex-row">
                    <span class="float-left p-2 flex-fill bg-success rounded-0">36</span>
                    <span class="float-right p-2 flex-fill bg-info rounded-0">89m2</span>
                </button>
                <button type="button" class="list-group-item rounded-0 list-group-item-action" disabled>Vestibulum at
                    eros
                </button>

                <div class="card rounded-0" style="">
                    <div class="card-body">
                        <h5 class="card-title">Description</h5>
                        <p class="card-text"><%= property.Description %></p>
                        <a href="#" class="btn btn-primary">Go somewhere</a>
                    </div>
                </div>


            </div>
        </div>

    </div>
    <div class="col-md-4">

        <div class="col-md-12" style="margin-bottom: 1rem;">
            <div class="card rounded-0 bg-light p-1">
                <div class="row justify-content-center">
                    <div class="col-md-6 mt-2">
                        <a href="members/<%= property.PostedBy._id %>">
                            <img class="card-img-top rounded-circle img-fluid  mb-2"
                                 src="<%= property.PostedBy.Avatar ?property.PostedBy.Avatar:"images/company/user.png" %>"
                                 alt="Card image cap"
                                 style="max-height: 10em;">
                        </a>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <span class="col-8 mb-2 align-content-center"><%= property.PostedBy.Fname+" "+property.PostedBy.Lname %></span>
                </div>
                <div class="row justify-content-center">
                    <div class="list-group border-0 mb-1 rounded-0 col-8">
                        <button type="button" class="list-group-item rounded-0 bg-light show-phone ">contact
                            <%= property.PostedBy.Phone.substring(0, 4) + "****" %>
                        </button>
                    </div>
                    <div class="list-group border-0 mb-1 rounded-0 col-8">
                        <button type="button" class="list-group-item rounded-0 bg-light hide-phone d-none ">Hide Contact
                        </button>
                    </div>
                    <div class="list-group border-0 mb-1 rounded-0 col-8">
                        <a type="button" href="tel: <%= property.PostedBy.Phone %>"
                           class="list-group-item rounded-0 bg-light d-none phone ">Call
                            <%= property.PostedBy.Phone %>
                        </a>
                    </div>
                    <div class="list-group border-0 mb-1 rounded-0 col-8">
                        <a href="sms://0780014047?body=I%27m%20interested%20in%20your%20product.%20Please%20contact%20me."
                           type="button" class="list-group-item rounded-0 bg-light">Send a message
                        </a>
                    </div>

                </div>
                <div class="bottom-wrap m-0 bg-transparent">
                    <div class="clearfix">
                                <span class="float-right">
                                <i class="fas fa-star fa-xs rating-style rating-style-full"></i>
                                <i class="fas fa-star rating-style rating-style-half"></i>
                                <i class="fas fa-star rating-style rating-style-half"></i>
                                <i class="fas fa-star-half-alt rating-style rating-style-half"></i>
                                <i class="far fa-star  rating-style rating-style-empty"></i>
                                </span>
                    </div>
                </div>
            </div>

        </div>

        <% for(var i = 0;i < 6;i++){ %>

        <div class=" col-md-12" style="margin-bottom: 1rem;">
            <div class="card rounded-0">
                <a href="property/1234567">
                    <img class="card-img-top rounded-0" src="images/company/logo.jpg" alt="Card image cap">
                </a>
                <div class="bottom-wrap m-0 bg-transparent">
                    <span class="float-left ml-1 h9">Nai/kawangware</span>
                    <div class="clearfix">
                                <span class="float-left">
                                <i class="fas fa-star fa-xs rating-style rating-style-full"></i>
                                <i class="fas fa-star rating-style rating-style-half"></i>
                                <i class="fas fa-star rating-style rating-style-half"></i>
                                <i class="fas fa-star-half-alt rating-style rating-style-half"></i>
                                <i class="far fa-star  rating-style rating-style-empty"></i>
                                </span>
                        <span class="float-right mt-1 pr-1" style="font-size: 12px;">Ksh:1280/mon</span>
                    </div>
                </div>
            </div>

        </div>

        <% } %>
    </div>


</div>
<%- include ../includes/navbottom %>
<%- include ../includes/footerjavascript %>
<script>
    var map;

    function initMap() {
        var center = new google.maps.LatLng(<%= property.Location.coordinates[0] + "," + property.Location.coordinates[1] %>);
        var mapcanvas = document.getElementById('mymap');
        var mapoptions = {
            center: center,
            zoom: 15,
            panControl: true,
            zoomControl: true,
            mapTypeControl: true,
            scaleControl: true,
            streetViewControl: true,
            overviewMapControl: true,
            rotateControl: true,
            mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},
            navigationControl: true,
            navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(mapcanvas, mapoptions);
        var marker = new google.maps.Marker({
            position: center,
            map: map,
            draggable: true
        });
        var street_view_centre = new Object();

        var panorama = new google.maps.StreetViewPanorama(
            document.getElementById('streetview'), {
                position: center,
                pov: {
                    heading: 34,
                    pitch: 10
                }
            });
        panorama.setVisible(true);
        map.setStreetView(panorama);
//        google.maps.event.trigger(panorama, 'resize');
        google.maps.event.addListener(marker, 'click', function (event) {
            var latitude = parseFloat(event.latLng.lat());
            var longitude = parseFloat(event.latLng.lng());
            console.log(latitude + ', ' + longitude);
            map.setZoom(15);
            map.setCenter({lat: latitude, lng: longitude});
        });
    }

    $("#streetview-tab").on("shown.bs.tab", function () {
        $("#streetview").removeClass("visibility-hidden");
    });

</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBT-Evo-QUfkHj_oQDi-w0xin2s4qFr7B0&callback=initMap"></script>
<script>
    var requrl = "https://maps.googleapis.com/maps/api/geocode/json?address=kondele&key=AIzaSyBwhrpQUNvleCxLuHiF1MGJ9Xo_801P2zk";
    var coordinate = $.getJSON(requrl, function (data) {
        return data.results[0].formatted_address;
    }).done(function (data) {
            console.log(data);
        }
    );


    $(".show-phone").on("click", function () {
        $(".hide-phone").removeClass("d-none");
        $(".phone").removeClass("d-none");
        $(this).addClass("d-none");
    });
    $(".hide-phone").on("click", function () {
        $(".show-phone").removeClass("d-none");
        $(".phone").addClass("d-none");
        $(this).addClass("d-none");
    });
</script>
<%- include ../includes/footer %>